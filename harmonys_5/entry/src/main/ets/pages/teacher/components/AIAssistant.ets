import { AIFunction, AIRecommendation, AITask, AIDesignSuggestion, AIAssistantState } from '../interfaces/TeacherInterfaces';

@Component
export struct AIAssistant {
  @State assistantState: AIAssistantState = {
    isVisible: false,
    currentMode: 'floating',
    activeFunction: null,
    recommendations: [],
    tasks: [],
    designSuggestions: []
  };

  @State aiFunctions: AIFunction[] = [
    {
      id: 'recommend',
      title: 'æ™ºèƒ½æ¨è',
      description: 'åŸºäºå½“å‰æ“ä½œä¸Šä¸‹æ–‡ï¼Œæä¾›åŠŸèƒ½å»ºè®®å’Œå†…å®¹è¡¥å…¨',
      icon: 'ğŸ¯',
      category: 'recommend',
      enabled: true
    },
    {
      id: 'delegate',
      title: 'AIä»£åŠ',
      description: 'è‡ªåŠ¨ç”Ÿæˆä½œä¸šé¢˜ç›®ã€è¯¾ç¨‹æè¿°ã€é¡µé¢å¸ƒå±€ç­‰å†…å®¹',
      icon: 'ğŸ¤–',
      category: 'delegate',
      enabled: true
    },
    {
      id: 'design',
      title: 'æ ·å¼è®¾è®¡',
      description: 'æŒ‡å¯¼é¡µé¢é£æ ¼ã€é…è‰²æ–¹æ¡ˆå’Œæ’ç‰ˆç»“æ„è®¾è®¡',
      icon: 'ğŸ¨',
      category: 'design',
      enabled: true
    },
    {
      id: 'analysis',
      title: 'æ™ºèƒ½åˆ†æ',
      description: 'åˆ†ææ•™å­¦æ•°æ®ï¼Œæä¾›ä¼˜åŒ–å»ºè®®å’Œè¶‹åŠ¿é¢„æµ‹',
      icon: 'ğŸ“Š',
      category: 'analysis',
      enabled: true
    }
  ];

  @State mockRecommendations: AIRecommendation[] = [
    {
      id: '1',
      type: 'course',
      title: 'æ¨èè¯¾ç¨‹ç»“æ„',
      description: 'åŸºäºæ‚¨çš„æ•™å­¦å†…å®¹ï¼Œå»ºè®®é‡‡ç”¨æ¨¡å—åŒ–è¯¾ç¨‹ç»“æ„',
      confidence: 0.92,
      context: 'å½“å‰æ­£åœ¨åˆ›å»ºæ–°è¯¾ç¨‹',
      action: 'åº”ç”¨æ¨èç»“æ„'
    },
    {
      id: '2',
      type: 'assignment',
      title: 'ä½œä¸šç±»å‹å»ºè®®',
      description: 'å»ºè®®æ·»åŠ å®è·µæ€§ä½œä¸šä»¥æé«˜å­¦ç”Ÿå‚ä¸åº¦',
      confidence: 0.85,
      context: 'ä½œä¸šç®¡ç†é¡µé¢',
      action: 'æŸ¥çœ‹è¯¦æƒ…'
    }
  ];

  @State mockTasks: AITask[] = [
    {
      id: '1',
      title: 'ç”Ÿæˆæ•°å­¦ç»ƒä¹ é¢˜',
      description: 'ä¸ºé«˜ç­‰æ•°å­¦è¯¾ç¨‹ç”Ÿæˆ20é“ç»ƒä¹ é¢˜',
      type: 'generate',
      status: 'completed',
      progress: 100,
      createdTime: '2024-01-15 10:30',
      completedTime: '2024-01-15 10:32'
    },
    {
      id: '2',
      title: 'ä¼˜åŒ–è¯¾ç¨‹é¡µé¢å¸ƒå±€',
      description: 'æ ¹æ®ç”¨æˆ·ä½“éªŒåŸåˆ™ä¼˜åŒ–è¯¾ç¨‹è¯¦æƒ…é¡µé¢',
      type: 'design',
      status: 'processing',
      progress: 65,
      createdTime: '2024-01-15 11:00'
    }
  ];

  build() {
    Stack() {
      // æµ®åŠ¨AIå›¾æ ‡
      if (!this.assistantState.isVisible) {
        this.buildFloatingIcon();
      }

      // AIåŠ©æ‰‹é¢æ¿
      if (this.assistantState.isVisible) {
        this.buildAssistantPanel();
      }
    }
    .width('100%')
    .height('100%');
  }

  @Builder
  buildFloatingIcon() {
    Button() {
      Row({ space: 8 }) {
        Text('ğŸ¤–')
          .fontSize(20);
        Text('AIåŠ©æ‰‹')
          .fontSize(14)
          .fontColor(Color.White)
          .fontWeight(FontWeight.Medium);
      }
    }
    .backgroundColor('#6366f1')
    .borderRadius(25)
    .padding({ left: 16, right: 16, top: 12, bottom: 12 })
    .shadow({ radius: 8, color: '#6366f140', offsetX: 0, offsetY: 4 })
    .position({ x: '85%', y: '85%' })
    .zIndex(1000)
    .onClick(() => {
      this.assistantState.isVisible = true;
      this.assistantState.currentMode = 'panel';
      this.loadRecommendations();
    })
    .gesture(
      PanGesture()
        .onActionUpdate((event: GestureEvent) => {
          // å®ç°æ‹–æ‹½åŠŸèƒ½
        })
    );
  }

  @Builder
  buildAssistantPanel() {
    Stack() {
      // èƒŒæ™¯é®ç½©
      Column()
        .width('100%')
        .height('100%')
        .backgroundColor('#00000040')
        .onClick(() => {
          this.assistantState.isVisible = false;
          this.assistantState.activeFunction = null;
        });

      // ä¸»é¢æ¿
      Column({ space: 0 }) {
        // å¤´éƒ¨
        this.buildPanelHeader();

        // å†…å®¹åŒºåŸŸ
        if (this.assistantState.activeFunction) {
          this.buildFunctionContent();
        } else {
          this.buildMainContent();
        }
      }
      .width('90%')
      .constraintSize({ maxWidth: 400 })
      .backgroundColor('#ffffff')
      .borderRadius(16)
      .shadow({ radius: 20, color: '#00000020', offsetX: 0, offsetY: 10 })
      .position({ x: '50%', y: '50%' })
      .translate({ x: '-50%', y: '-50%' });
    }
    .width('100%')
    .height('100%')
    .zIndex(2000);
  }

  @Builder
  buildPanelHeader() {
    Row({ space: 16 }) {
      if (this.assistantState.activeFunction) {
        Button('â†')
          .backgroundColor('#f3f4f6')
          .fontColor('#6b7280')
          .borderRadius(8)
          .padding(8)
          .onClick(() => {
            this.assistantState.activeFunction = null;
          });
      }

      Text(this.assistantState.activeFunction ?
      this.getFunctionTitle(this.assistantState.activeFunction) : 'ğŸ¤– AIæ™ºèƒ½åŠ©æ‰‹')
        .fontSize(18)
        .fontWeight(FontWeight.Bold)
        .fontColor('#1f2937')
        .layoutWeight(1);

      Button('âœ•')
        .backgroundColor('#f3f4f6')
        .fontColor('#6b7280')
        .borderRadius(8)
        .padding(8)
        .onClick(() => {
          this.assistantState.isVisible = false;
          this.assistantState.activeFunction = null;
        });
    }
    .width('100%')
    .padding(20)
    .borderRadius({ topLeft: 16, topRight: 16 })
    .backgroundColor('#ffffff');
  }

  @Builder
  buildMainContent() {
    Column({ space: 20 }) {
      // åŠŸèƒ½å…¥å£
      Text('ğŸš€ AIèµ‹èƒ½åŠŸèƒ½')
        .fontSize(16)
        .fontWeight(FontWeight.Medium)
        .fontColor('#374151')
        .alignSelf(ItemAlign.Start);

      Grid() {
        ForEach(this.aiFunctions, (func: AIFunction) => {
          GridItem() {
            this.buildFunctionCard(func);
          }
        });
      }
      .columnsTemplate('1fr 1fr')
      .rowsGap(12)
      .columnsGap(12)
      .height(200);

      // å¿«é€Ÿæ¨è
      if (this.mockRecommendations.length > 0) {
        Column({ space: 12 }) {
          Text('ğŸ’¡ æ™ºèƒ½æ¨è')
            .fontSize(16)
            .fontWeight(FontWeight.Medium)
            .fontColor('#374151')
            .alignSelf(ItemAlign.Start);

          ForEach(this.mockRecommendations.slice(0, 2), (rec: AIRecommendation) => {
            this.buildRecommendationItem(rec);
          });
        }
        .alignItems(HorizontalAlign.Start);
      }

      // æœ€è¿‘ä»»åŠ¡
      if (this.mockTasks.length > 0) {
        Column({ space: 12 }) {
          Row({ space: 8 }) {
            Text('ğŸ“‹ æœ€è¿‘ä»»åŠ¡')
              .fontSize(16)
              .fontWeight(FontWeight.Medium)
              .fontColor('#374151')
              .layoutWeight(1);

            Text('æŸ¥çœ‹å…¨éƒ¨')
              .fontSize(14)
              .fontColor('#6366f1')
              .onClick(() => {
                this.assistantState.activeFunction = 'delegate';
              });
          }
          .width('100%');

          ForEach(this.mockTasks.slice(0, 2), (task: AITask) => {
            this.buildTaskItem(task);
          });
        }
        .alignItems(HorizontalAlign.Start);
      }
    }
    .width('100%')
    .padding(20)
    .alignItems(HorizontalAlign.Start);
  }

  @Builder
  buildFunctionCard(func: AIFunction) {
    Column({ space: 8 }) {
      Text(func.icon)
        .fontSize(24);

      Text(func.title)
        .fontSize(14)
        .fontWeight(FontWeight.Medium)
        .fontColor('#1f2937')
        .textAlign(TextAlign.Center);

      Text(func.description)
        .fontSize(12)
        .fontColor('#6b7280')
        .textAlign(TextAlign.Center)
        .maxLines(2)
        .textOverflow({ overflow: TextOverflow.Ellipsis });
    }
    .width('100%')
    .padding(16)
    .backgroundColor(func.enabled ? '#ffffff' : '#f9fafb')
    .borderRadius(12)
    .border({ width: 1, color: func.enabled ? '#e5e7eb' : '#f3f4f6' })
    .shadow({ radius: 2, color: '#00000010', offsetX: 0, offsetY: 1 })
    .onClick(() => {
      if (func.enabled) {
        this.assistantState.activeFunction = func.id;
      }
    });
  }

  @Builder
  buildFunctionContent() {
    Scroll() {
      Column({ space: 16 }) {
        if (this.assistantState.activeFunction === 'recommend') {
          this.buildRecommendationContent();
        } else if (this.assistantState.activeFunction === 'delegate') {
          this.buildDelegateContent();
        } else if (this.assistantState.activeFunction === 'design') {
          this.buildDesignContent();
        } else if (this.assistantState.activeFunction === 'analysis') {
          this.buildAnalysisContent();
        }
      }
      .width('100%')
      .padding(20);
    }
    .scrollable(ScrollDirection.Vertical)
    .scrollBar(BarState.Auto)
    .layoutWeight(1);
  }

  @Builder
  buildRecommendationContent() {
    Column({ space: 16 }) {
      Text('åŸºäºæ‚¨å½“å‰çš„æ“ä½œä¸Šä¸‹æ–‡ï¼ŒAIä¸ºæ‚¨æ¨èä»¥ä¸‹åŠŸèƒ½å’Œå†…å®¹ï¼š')
        .fontSize(14)
        .fontColor('#6b7280')
        .lineHeight(20);

      ForEach(this.mockRecommendations, (rec: AIRecommendation) => {
        this.buildRecommendationItem(rec);
      });

      Button('åˆ·æ–°æ¨è')
        .backgroundColor('#6366f1')
        .fontColor(Color.White)
        .borderRadius(8)
        .padding({ left: 24, right: 24, top: 12, bottom: 12 })
        .onClick(() => {
          this.loadRecommendations();
        });
    }
    .alignItems(HorizontalAlign.Start);
  }

  @Builder
  buildDelegateContent() {
    Column({ space: 16 }) {
      Text('AIå¯ä»¥å¸®æ‚¨è‡ªåŠ¨å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼ŒèŠ‚çœæ‚¨çš„æ—¶é—´ï¼š')
        .fontSize(14)
        .fontColor('#6b7280')
        .lineHeight(20);

      // å¿«é€Ÿä»»åŠ¡æŒ‰é’®
      Grid() {
        GridItem() {
          this.buildQuickTaskButton('ç”Ÿæˆä½œä¸šé¢˜ç›®', 'ğŸ“', () => {
            this.createTask('ç”Ÿæˆä½œä¸šé¢˜ç›®', 'ä¸ºå½“å‰è¯¾ç¨‹ç”Ÿæˆç»ƒä¹ é¢˜', 'generate');
          });
        }
        GridItem() {
          this.buildQuickTaskButton('åˆ›å»ºè¯¾ç¨‹æè¿°', 'ğŸ“š', () => {
            this.createTask('åˆ›å»ºè¯¾ç¨‹æè¿°', 'ç”Ÿæˆè¯¾ç¨‹ä»‹ç»å’Œå¤§çº²', 'generate');
          });
        }
        GridItem() {
          this.buildQuickTaskButton('è®¾è®¡é¡µé¢å¸ƒå±€', 'ğŸ¨', () => {
            this.createTask('è®¾è®¡é¡µé¢å¸ƒå±€', 'ä¼˜åŒ–å½“å‰é¡µé¢çš„å¸ƒå±€ç»“æ„', 'design');
          });
        }
        GridItem() {
          this.buildQuickTaskButton('åˆ†æå­¦ä¹ æ•°æ®', 'ğŸ“Š', () => {
            this.createTask('åˆ†æå­¦ä¹ æ•°æ®', 'ç”Ÿæˆå­¦ä¹ æ•ˆæœåˆ†ææŠ¥å‘Š', 'analyze');
          });
        }
      }
      .columnsTemplate('1fr 1fr')
      .rowsGap(12)
      .columnsGap(12)
      .height(120);

      Text('ä»»åŠ¡åˆ—è¡¨')
        .fontSize(16)
        .fontWeight(FontWeight.Medium)
        .fontColor('#374151');

      ForEach(this.mockTasks, (task: AITask) => {
        this.buildTaskItem(task);
      });
    }
    .alignItems(HorizontalAlign.Start);
  }

  @Builder
  buildDesignContent() {
    Column({ space: 16 }) {
      Text('AIè®¾è®¡åŠ©æ‰‹å¯ä»¥å¸®æ‚¨ä¼˜åŒ–ç•Œé¢è®¾è®¡å’Œç”¨æˆ·ä½“éªŒï¼š')
        .fontSize(14)
        .fontColor('#6b7280')
        .lineHeight(20);

      // è®¾è®¡ç±»åˆ«
      Row({ space: 12 }) {
        Button('å¸ƒå±€ä¼˜åŒ–')
          .backgroundColor('#dbeafe')
          .fontColor('#2563eb')
          .borderRadius(20)
          .padding({ left: 16, right: 16, top: 8, bottom: 8 })
          .fontSize(12);

        Button('é…è‰²æ–¹æ¡ˆ')
          .backgroundColor('#dcfce7')
          .fontColor('#16a34a')
          .borderRadius(20)
          .padding({ left: 16, right: 16, top: 8, bottom: 8 })
          .fontSize(12);

        Button('ç»„ä»¶æ ·å¼')
          .backgroundColor('#fef3c7')
          .fontColor('#d97706')
          .borderRadius(20)
          .padding({ left: 16, right: 16, top: 8, bottom: 8 })
          .fontSize(12);
      }

      // è®¾è®¡å»ºè®®
      Column({ space: 12 }) {
        this.buildDesignSuggestionItem({
          id: '1',
          category: 'layout',
          title: 'å¡ç‰‡å¼å¸ƒå±€ä¼˜åŒ–',
          description: 'å»ºè®®é‡‡ç”¨æ›´ç°ä»£çš„å¡ç‰‡å¼å¸ƒå±€ï¼Œæå‡è§†è§‰å±‚æ¬¡',
          preview: 'é¢„è§ˆæ•ˆæœ',
          applicable: true
        });

        this.buildDesignSuggestionItem({
          id: '2',
          category: 'color',
          title: 'é…è‰²æ–¹æ¡ˆè°ƒæ•´',
          description: 'å»ºè®®ä½¿ç”¨æ›´æŸ”å’Œçš„é…è‰²ï¼Œæå‡ç”¨æˆ·ä½“éªŒ',
          preview: 'é¢„è§ˆæ•ˆæœ',
          applicable: true
        });
      }
    }
    .alignItems(HorizontalAlign.Start);
  }

  @Builder
  buildAnalysisContent() {
    Column({ space: 16 }) {
      Text('AIæ™ºèƒ½åˆ†æä¸ºæ‚¨æä¾›æ•°æ®æ´å¯Ÿå’Œä¼˜åŒ–å»ºè®®ï¼š')
        .fontSize(14)
        .fontColor('#6b7280')
        .lineHeight(20);

      // åˆ†æç±»å‹
      Grid() {
        GridItem() {
          this.buildAnalysisCard('å­¦ä¹ æ•ˆæœåˆ†æ', 'ğŸ“ˆ', 'åˆ†æå­¦ç”Ÿå­¦ä¹ æ•°æ®å’Œè¿›åº¦');
        }
        GridItem() {
          this.buildAnalysisCard('è¯¾ç¨‹ä¼˜åŒ–å»ºè®®', 'ğŸ¯', 'åŸºäºæ•°æ®æä¾›è¯¾ç¨‹æ”¹è¿›å»ºè®®');
        }
        GridItem() {
          this.buildAnalysisCard('è¶‹åŠ¿é¢„æµ‹', 'ğŸ”®', 'é¢„æµ‹å­¦ä¹ è¶‹åŠ¿å’Œæ½œåœ¨é—®é¢˜');
        }
        GridItem() {
          this.buildAnalysisCard('ä¸ªæ€§åŒ–æ¨è', 'ğŸ‘¤', 'ä¸ºæ¯ä¸ªå­¦ç”Ÿæä¾›ä¸ªæ€§åŒ–å»ºè®®');
        }
      }
      .columnsTemplate('1fr 1fr')
      .rowsGap(12)
      .columnsGap(12)
      .height(160);

      Button('å¼€å§‹åˆ†æ')
        .backgroundColor('#6366f1')
        .fontColor(Color.White)
        .borderRadius(8)
        .padding({ left: 24, right: 24, top: 12, bottom: 12 })
        .onClick(() => {
          this.startAnalysis();
        });
    }
    .alignItems(HorizontalAlign.Start);
  }

  @Builder
  buildRecommendationItem(rec: AIRecommendation) {
    Row({ space: 12 }) {
      Column({ space: 4 }) {
        Text(rec.title)
          .fontSize(14)
          .fontWeight(FontWeight.Medium)
          .fontColor('#1f2937');

        Text(rec.description)
          .fontSize(12)
          .fontColor('#6b7280')
          .maxLines(2)
          .textOverflow({ overflow: TextOverflow.Ellipsis });

        Row({ space: 8 }) {
          Text(`ç½®ä¿¡åº¦: ${Math.round(rec.confidence * 100)}%`)
            .fontSize(11)
            .fontColor('#9ca3af');
          Text(rec.context)
            .fontSize(11)
            .fontColor('#9ca3af');
        }
      }
      .alignItems(HorizontalAlign.Start)
      .layoutWeight(1);

      Button(rec.action)
        .backgroundColor('#dbeafe')
        .fontColor('#2563eb')
        .borderRadius(6)
        .padding({ left: 12, right: 12, top: 6, bottom: 6 })
        .fontSize(12)
        .onClick(() => {
          this.applyRecommendation(rec);
        });
    }
    .width('100%')
    .padding(12)
    .backgroundColor('#ffffff')
    .borderRadius(8)
    .border({ width: 1, color: '#e5e7eb' });
  }

  @Builder
  buildTaskItem(task: AITask) {
    Column({ space: 8 }) {
      Row({ space: 12 }) {
        Text(this.getTaskIcon(task.type))
          .fontSize(16);

        Column({ space: 2 }) {
          Text(task.title)
            .fontSize(14)
            .fontWeight(FontWeight.Medium)
            .fontColor('#1f2937');

          Text(task.description)
            .fontSize(12)
            .fontColor('#6b7280')
            .maxLines(1)
            .textOverflow({ overflow: TextOverflow.Ellipsis });
        }
        .alignItems(HorizontalAlign.Start)
        .layoutWeight(1);

        Text(this.getStatusText(task.status))
          .fontSize(12)
          .fontColor(this.getStatusColor(task.status))
          .backgroundColor(this.getStatusBgColor(task.status))
          .borderRadius(4)
          .padding({ left: 8, right: 8, top: 4, bottom: 4 });
      }

      if (task.status === 'processing') {
        Progress({ value: task.progress, total: 100, type: ProgressType.Linear })
          .width('100%')
          .color('#6366f1')
          .backgroundColor('#e5e7eb');
      }
    }
    .width('100%')
    .padding(12)
    .backgroundColor('#ffffff')
    .borderRadius(8)
    .border({ width: 1, color: '#e5e7eb' })
    .onClick(() => {
      this.viewTaskDetail(task);
    });
  }

  @Builder
  buildQuickTaskButton(title: string, icon: string, action: () => void) {
    Column({ space: 4 }) {
      Text(icon)
        .fontSize(20);
      Text(title)
        .fontSize(12)
        .fontColor('#374151')
        .textAlign(TextAlign.Center)
        .maxLines(2)
        .textOverflow({ overflow: TextOverflow.Ellipsis });
    }
    .width('100%')
    .padding(12)
    .backgroundColor('#ffffff')
    .borderRadius(8)
    .border({ width: 1, color: '#e5e7eb' })
    .onClick(action);
  }

  @Builder
  buildDesignSuggestionItem(suggestion: AIDesignSuggestion) {
    Row({ space: 12 }) {
      Column({ space: 4 }) {
        Text(suggestion.title)
          .fontSize(14)
          .fontWeight(FontWeight.Medium)
          .fontColor('#1f2937');

        Text(suggestion.description)
          .fontSize(12)
          .fontColor('#6b7280')
          .maxLines(2)
          .textOverflow({ overflow: TextOverflow.Ellipsis });
      }
      .alignItems(HorizontalAlign.Start)
      .layoutWeight(1);

      Button('åº”ç”¨')
        .backgroundColor(suggestion.applicable ? '#dcfce7' : '#f3f4f6')
        .fontColor(suggestion.applicable ? '#16a34a' : '#9ca3af')
        .borderRadius(6)
        .padding({ left: 12, right: 12, top: 6, bottom: 6 })
        .fontSize(12)
        .enabled(suggestion.applicable)
        .onClick(() => {
          this.applyDesignSuggestion(suggestion);
        });
    }
    .width('100%')
    .padding(12)
    .backgroundColor('#ffffff')
    .borderRadius(8)
    .border({ width: 1, color: '#e5e7eb' });
  }

  @Builder
  buildAnalysisCard(title: string, icon: string, description: string) {
    Column({ space: 8 }) {
      Text(icon)
        .fontSize(20);
      Text(title)
        .fontSize(12)
        .fontWeight(FontWeight.Medium)
        .fontColor('#1f2937')
        .textAlign(TextAlign.Center);
      Text(description)
        .fontSize(10)
        .fontColor('#6b7280')
        .textAlign(TextAlign.Center)
        .maxLines(2)
        .textOverflow({ overflow: TextOverflow.Ellipsis });
    }
    .width('100%')
    .padding(12)
    .backgroundColor('#ffffff')
    .borderRadius(8)
    .border({ width: 1, color: '#e5e7eb' })
    .onClick(() => {
      this.startSpecificAnalysis(title);
    });
  }

  // è¾…åŠ©æ–¹æ³•
  getFunctionTitle(functionId: string): string {
    const func = this.aiFunctions.find(f => f.id === functionId);
    return func ? `${func.icon} ${func.title}` : 'AIåŠŸèƒ½';
  }

  getTaskIcon(type: string): string {
    switch (type) {
      case 'generate': return 'ğŸ“';
      case 'optimize': return 'âš¡';
      case 'analyze': return 'ğŸ“Š';
      case 'design': return 'ğŸ¨';
      default: return 'ğŸ¤–';
    }
  }

  getStatusText(status: string): string {
    switch (status) {
      case 'pending': return 'ç­‰å¾…ä¸­';
      case 'processing': return 'å¤„ç†ä¸­';
      case 'completed': return 'å·²å®Œæˆ';
      case 'failed': return 'å¤±è´¥';
      default: return 'æœªçŸ¥';
    }
  }

  getStatusColor(status: string): string {
    switch (status) {
      case 'pending': return '#f59e0b';
      case 'processing': return '#3b82f6';
      case 'completed': return '#10b981';
      case 'failed': return '#ef4444';
      default: return '#6b7280';
    }
  }

  getStatusBgColor(status: string): string {
    switch (status) {
      case 'pending': return '#fef3c7';
      case 'processing': return '#dbeafe';
      case 'completed': return '#dcfce7';
      case 'failed': return '#fee2e2';
      default: return '#f3f4f6';
    }
  }

  // ä¸šåŠ¡æ–¹æ³•
  loadRecommendations() {
    // æ¨¡æ‹ŸåŠ è½½æ¨èå†…å®¹
    this.assistantState.recommendations = this.mockRecommendations;
  }

  applyRecommendation(rec: AIRecommendation) {
    // åº”ç”¨æ¨è
    console.log('åº”ç”¨æ¨è:', rec.title);
  }

  createTask(title: string, description: string, type: string) {
    const newTask: AITask = {
      id: Date.now().toString(),
      title,
      description,
      type: type as 'generate' | 'optimize' | 'analyze' | 'design',
      status: 'pending',
      progress: 0,
      createdTime: new Date().toLocaleString()
    };
    this.mockTasks.unshift(newTask);

    // æ¨¡æ‹Ÿä»»åŠ¡å¤„ç†
    setTimeout(() => {
      newTask.status = 'processing';
      this.simulateTaskProgress(newTask);
    }, 1000);
  }

  simulateTaskProgress(task: AITask) {
    const interval = setInterval(() => {
      task.progress += Math.random() * 20;
      if (task.progress >= 100) {
        task.progress = 100;
        task.status = 'completed';
        task.completedTime = new Date().toLocaleString();
        clearInterval(interval);
      }
    }, 500);
  }

  viewTaskDetail(task: AITask) {
    // æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…
    console.log('æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…:', task.title);
  }

  applyDesignSuggestion(suggestion: AIDesignSuggestion) {
    // åº”ç”¨è®¾è®¡å»ºè®®
    console.log('åº”ç”¨è®¾è®¡å»ºè®®:', suggestion.title);
  }

  startAnalysis() {
    // å¼€å§‹åˆ†æ
    this.createTask('æ™ºèƒ½æ•°æ®åˆ†æ', 'åˆ†æå½“å‰æ•™å­¦æ•°æ®å¹¶ç”ŸæˆæŠ¥å‘Š', 'analyze');
  }

  startSpecificAnalysis(type: string) {
    // å¼€å§‹ç‰¹å®šåˆ†æ
    this.createTask(type, `æ‰§è¡Œ${type}ä»»åŠ¡`, 'analyze');
  }
}